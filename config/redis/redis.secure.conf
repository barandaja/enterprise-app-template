# Redis configuration for secure production use
# Enhanced security settings

# ========================================
# Persistence Configuration
# ========================================
# Save the DB to disk
save 900 1
save 300 10
save 60 10000

# Enable AOF persistence
appendonly yes
appendfsync everysec

# ========================================
# Memory Management
# ========================================
maxmemory 256mb
maxmemory-policy allkeys-lru

# ========================================
# Network Configuration
# ========================================
# Bind to all interfaces (Docker internal network)
bind 0.0.0.0
port 6379
tcp-backlog 511
timeout 300
tcp-keepalive 300

# ========================================
# General Settings
# ========================================
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""
databases 16

# ========================================
# Security Configuration
# ========================================
# Enable protected mode
protected-mode yes

# Password is set via command line argument
# requirepass will be set by Docker command

# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_e8f9c6d5a2b1"
rename-command SHUTDOWN "SHUTDOWN_7f3a2b1c9d8e"

# ========================================
# Performance Monitoring
# ========================================
# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitoring
latency-monitor-threshold 100

# ========================================
# Client Connection Limits
# ========================================
maxclients 10000

# ========================================
# Advanced Security
# ========================================
# Enable ACL (Access Control Lists)
aclfile /etc/redis/users.acl

# TLS/SSL Configuration (if needed)
# port 0
# tls-port 6379
# tls-cert-file /etc/redis/tls/redis.crt
# tls-key-file /etc/redis/tls/redis.key
# tls-ca-cert-file /etc/redis/tls/ca.crt
# tls-dh-params-file /etc/redis/tls/redis.dh

# ========================================
# Snapshotting Security
# ========================================
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes

# ========================================
# Command Renaming for Security
# ========================================
# Additional dangerous commands to disable
rename-command DEBUG ""
rename-command SCRIPT ""